# 计算机网络概述

## 网络的网络

网络把主机连接起来，而互联网（internet）是把多种不同的网络连接起来，因此互联网是网络的网络。而因特网（Internet）是全球范围的互联网。

### ISP

互联网服务提供商 ISP 可以从互联网管理机构获得许多 IP 地址，同时拥有通信线路以及路由器等联网设备，个人或机构向 ISP 缴纳一定的费用就可以接入互联网。

![](.\计算机网络学习笔记\ISP的互联.png)

目前的互联网是一种多层次 ISP 结构，ISP 根据覆盖面积的大小分为第一层 ISP、区域 ISP 和接入 ISP。互联网交换点 IXP 允许两个 ISP 直接相连而不用经过第三个 ISP。

## 网络

> 按照不同的划分标准，网络可被分为多种。

### 地理位置

1.局域网（LAN）：一般限定在较小的区域内，小于10km的范围，通常采用有线的方式连接起来。

2.城域网（MAN）：规模局限在一座城市的范围内，10～100km的区域。

3.广域网（WAN）：网络跨越国界、洲界，甚至全球范围。

局域网和广域网是网络的热点。局域网是组成其他两种类型网络的基础，城域网一般都加入了广域网。广域网的典型代表是 internet 网。

### 传输介质

1.有线网：采用同轴电缆和双绞线来连接的计算机网络。

同轴电缆网是常见的一种连网方式。它比较经济，安装较为便利，传输率和抗干扰能力一般，传输距离较短。

双绞线网是最常见的连网方式。它价格便宜，安装方便，但易受干扰，传输率较低，传输距离比同轴电缆要短。

2.光纤网：光纤网也是有线网的一种，但由于其特殊性而单独列出，光纤网采用光导纤维作传输介质。光纤传输距离长，传输率高，可达数千兆bps，抗干扰性强，不会受到电子监听设备的监听，是高安全性网络的理想选择。不过由于其价格较高，且需要高水平的安装技术。

3.无线网：用电磁波作为载体来传输数据，无线网联网费用较高，还不太普及。但由于联网方式灵活方便，是一种很有前途的连网方式。



## 计算机网络的性能指标

### 速率

速率就是数据传输的速率

### 带宽

网络带宽是指在单位时间内**能**传输的数据量

### 吞吐量

吞吐量表示在单位时间内**通过**的数据量

### 时延

时延是指数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需的时间。

总时延 =  处理时延 + 排队时延 +  传输时延 + 传播时延

<img src=".\计算机网络学习笔记\网络节点时延.png" style="zoom:67%;" />

#### 处理时延

网络节点收到分组时进行处理所需的时间，如分析首部、进行差错检验和查找路由等。

#### 排队时延

分组在节点的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。

#### 传输时延

节点将分组的比特流全部推（传输）向链路所需的时间。

![](.\计算机网络学习笔记\传输时延计算公式.png)

其中 l 表示数据帧的长度，v 表示传输速率。

#### 传播时延

分组从一条链路的一端传输到另一端所需要的时间，取决于该链路的长度和传播速率。

![](.\计算机网络学习笔记\传播时延计算公式.png)

其中 l 表示该链路长度，v 表示该链路的传播速度。



# 网络模型

## OSI模型

> **开放式系统互联模型**（英语：**O**pen **S**ystem **I**nterconnection Model，缩写：OSI；简称为**OSI模型**）是一种概念模型，由国际标准化组织提出，一个试图使各种计算机在世界范围内互连为网络的标准框架。

## TCP/IP模型

> TCP/IP 模型是 OSI 模型在 Internet 中的实现。

<img src=".\计算机网络学习笔记\TCP_IP模型.png" style="zoom:50%;" />

## 模型分层的原因

> 网络通信是一个非常复杂的过程，通过分层，每层只负责通信的一个方面。这样不同领域的开发人员（通信软件开发人员、路由器开发人员、通信介质开发人员等）只需实现通信系统的一部分，而不需要考虑所有通信细节。



## 模型分层的优劣

+ 优点
  + 层与层之间耦合度低，在层间接口不变的情况下，各层自身的改变不会影响到其他层
+ 缺点
  + 层与层之间的数据交互过程会带来一定的延时



## 数据处理流程

在基于 TCP/IP 模型的网络数据通信过程中，对数据的处理本质上是一个向下逐层封装，向上逐层分用的过程。

<img src=".\计算机网络学习笔记\TCPIP数据流.jpg"  />

### 封装

网络协议栈中，各层数据帧的首部都有一个帧类型域，用于说明其数据部分中的数据报的类型，如以太网帧的首部用一个16bit的**以太网协议号**来表示不同的网络层数据报（ip、arp）；IP数据报在首部用一个8bit的**IP协议号**来表示其包含的传输层报文类型（icmp、tcp、udp）；TCP和UDP都用一个16bit的**端口号**来表示不同的应用层报文类型（ftp、http、telnet）。

<img src=".\计算机网络学习笔记\通信数据封装.png" style="zoom: 25%;" />

### 分用

<img src=".\计算机网络学习笔记\通信数据分用.png" style="zoom:25%;" />



# 应用层

> 处理特定的应用程序细节。



# 传输层

> 网络层只把分组发送到目的主机，但真正通信的并不是主机而是**主机中的进程**。
>
> 传输层为两台主机上的应用程序（进程）提供**端到端的逻辑通信**，传输层向高层用户屏蔽了下面网络层的核心细节，使应用程序看起来像是在两个传输层实体之间有一条端到端的逻辑通信信道。

## UDP和TCP的特点

+ 用户数据报协议 UDP（User Datagram Protocol）是**无连接**的，尽最大可能交互，没有拥塞控制，**面向报文**（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。

  使用场景：对通信速度要求高。

+ 传输控制协议 TCP（Transmission Control Protocol）是**面向连接**的，提供**可靠交付**，有**流量控制**，**拥塞控制**，提供全双工通信，**面向字节流**（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是**点对点**的（一对一）。

  使用场景：对通信质量要求高。



## UDP首部格式

<img src=".\计算机网络学习笔记\UDP首部.jpg" style="zoom:50%;" />

首部字段只有8个字节，包括源端口、目的端口、长度、校验和。12字节的伪首部是为了计算检验和临时添加的。



## TCP首部格式

<img src=".\计算机网络学习笔记\TCP首部.png" style="zoom:50%;" />

+ **序号**：用于对字节流进行编号，例如序号为301，表示第一个字节的编号为301，如果携带的数据长度为100字节，那么下一个报文段的序号应为401。
+ **确认号**：期望收到的下一个报文段的序号。例如B正确收到A发送来的一个报文段，序号为501，携带的数据长度为200字节，因此B期望下一个报文段的序号为701，B发送给A的确认号就为701。
+ **数据偏移**：指的是数据部分距离报文段起始处的偏移量，实际上指的是首部的长度。
+ **确认ACK**：当ACK=1时确认号字段有效，否则无效。TCP规定，在连接建立后所有传送的报文段都必须把ACK置1。
+ **同步SYN**：在连接建立时用来同步序号。当SYN=1，ACK=0时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中SYN=1，ACK=1。
+ **终止FIN**：用来释放一个连接，当FIN=1时，表示此报文段的发送方的数据已发送完毕，并要求释放连接。
+ **窗口**：窗口值作为接收方让发送方设置其发送窗口的依据。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。



## TCP的三次握手

> 通过发送3个特殊的报文段完成一个 TCP 连接的建立的过程。
>
> 一个 TCP 连接是由一对套接字构成，其中通信的每一端都由一对（IP地址，端口号）所唯一标识。

<img src=".\计算机网络学习笔记\TCP三次握手.png" style="zoom:50%;" />

TCP 连接握手，**约定通信双方的 ISN** （Initial Sequence Number）初始序列号，以用于后面的接收和重传。

+ 首先 B 处于LISTEN（监听）状态，等待客户的连接请求。
+ A 向 B发送连接请求报文，SYN = 1，ACK = 0，选择一个**初始的序列号** x。
+ B 收到连接请求报文，如果同意建立连接，则向 A 发送连接确认报文，SYN = 1，ACK = 1，确认号为 x + 1，同时也选择一个**初始的序列号** y。
+ A 收到 B 的连接确认报文后，还要向 B 发出确认，确认号为 y +  1，序号为 x + 1。
+ B 收到 A 的确认后，连接建立。

**三次握手的原因**

> 通过三次握手来**确认双方都可以获得对方的初始序列号**，初始序列号是后面进行可靠重传或接收的基础。
>
> 为了在不可靠的信道上进行可靠的传输所必须采取的行为。

为了**防止已失效的连接请求报文段突然又传送到了服务端**，因而产生错误。

假设不采用“三次握手”，那么只有 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。

这个问题的本质是, 信道不可靠, 但是通信双方需要就某个问题达成一致. 而要解决这个问题, 无论你在消息中包含什么信息, 三次通信是理论上的最小值. 所以三次握手不是TCP本身的要求, 而是为了满足"**在不可靠信道上可靠地传输信息**"这一需求所导致的.



## TCP的四次挥手

<img src=".\计算机网络学习笔记\TCP连接释放.jpg" style="zoom:50%;" />

+ A 发送连接释放报文，FIN = 1.
+ B 收到之后发出确认，此时 TCP 属于**半关闭**状态，B 能向 A 发送数据但是 A 不能向 B 发送数据。
+ 当 B 不再需要连接时，发送连接释放报文，FIN = 1。
+ A 收到后发出确认，进入 TIME-WAIT 状态，等待 2 MSL（最大报文存活时间）后**释放连接**。
+ B 收到 A 的确认后**释放连接**。



**四次挥手的原因**

四次挥手其实是客户端和服务端的两次挥手，也就是客户端和服务端**分别释放**连接的过程。

1）由于**客户端最后一个ACK可能会丢失**，这样 B 就无法正常进入 CLOSED 状态。于是 B 会重传请求释放的报文，而此时A如果已经关闭了，那就收不到 B 的重传请求，就会**导致B不能正常释放**。而如果 A 还在等待时间内，就会收到 B 的重传，然后进行应答，这样B就可以进入 CLOSED 状态了。

2）在这 2MSL 等待时间里面，本次连接的所有的报文都已经**从网络中消失**，从而不会出现在下次连接中。



## TCP可靠传输

TCP 主要通过以下四种方式实现可靠传输机制：

+ 校验

+ 序号

  TCP 是面向字节流的，每一个字节都对应着一个序号。在 TCP 首部中，有一个序号字段，指的就是一个报文段第一个字节的序号。有了序号，就能保证数据能够有序的传递给应用层。

+ 确认

  TCP 传输中发送的每一个报文，都必须被确认接收，若没有收到确认消息，则发送方会重新发送该报文。

+ 重传

  TCP 针对数据包丢失的情况，会采用重传机制解决。常见的重传机制有：

  + 超时重传
  + 快速重传
  + SACK

**超时重传**

> 在发送数据时，设定一个定时器，当计时时间到后，没有收到对方的 `ACK` 确认应答报文，就会重发该数据。

超时重传的关键在于**如何设定超时时间**，超时重传时间以 `RTO` （Retransmission Timeout 超时重传时间）表示，超时时间过长或过短都会带来相应的问题：

<img src=".\计算机网络学习笔记\超时时间过长或过短.jpg" style="zoom:50%;" />

鉴于以上的两种情况，超时重传时间 `RTO` 的值应该略大于报文往返 `RTT`（一个报文段从发送再到接收到确认所经过的时间） 的值。

实际上「报文往返 `RTT` 的值」是经常变化的，因为我们的网络也是时常变化的。也就因为「报文往返 `RTT` 的值」 是经常波动变化的，所以「超时重传时间 `RTO` 的值」应该是一个**动态变化的值**。



**快速重传**

> 与超时重传不同，快速重传（Fast Retransmit）不以时间为驱动，而是以数据驱动重传

<img src=".\计算机网络学习笔记\快速重传.jpg" style="zoom:50%;" />

快速重传的工作方式是当收到三个相同的 ACK 报文时，重传丢失的报文段。

快速重传的问题：重传的时候，是重传之前的一个，还是重传所有。



**SACK**

> `SACK（Selective Acknowledgment）`，即选择性确认

<img src=".\计算机网络学习笔记\选择性确认.jpg" style="zoom:50%;" />

这种方式需要在 TCP 头部选项字段里加一个 `SACK` 的东西，它可以将缓存的数据段发送给发送方，这样发送方就可以知道哪些数据收到了，哪些数据没收到，这样就可以只重传丢失的数据。



## TCP滑动窗口

> 窗口是**缓存**的一部分，是对用来**暂时存放**发送方和接收方之间流动的字节流的**缓存空间**的反映。
>
> TCP 以字节（而非包）为单位维护其窗口结构。

### 引入窗口机制的原因

> TCP 发送的每一个数据包，都需要进行确认应答。当上一个数据包收到应答后，再继续发送下一个。这种传输方式的通信效率太低。
>
> 有了窗口机制后，就能**一次发送窗口所能容纳的最大数量的数据包**。
>
> 窗口的实现实际上是操作系统开辟的一个缓存空间，发送方主机在等到确认应答返回之前，必须在缓冲区中保留已发送的数据。如果按期收到确认应答，此时确认的数据就可以从缓存区清除。
>
> 接收方主机在已发送确认并交付主机之前，必须在缓存区中保留已接收的数据。如果接收到的数据**已发送确认并交付主机，就可以从缓存区清除**。

### 发送方的滑动窗口

> 发送窗口用于记录可以发送的数据的范围，其大小反映了发送方当前**可以发送的最大数据量**，并受**接收端通知窗口**和**拥塞窗口**的控制。

TCP 发送方滑动窗口方案使用三个指针来跟踪在四个传输类别中的每一个类别中的字节。其中两个指针是绝对指针（指特定的序列号），一个是相对指针（需要做偏移）。

<img src=".\计算机网络学习笔记\TCP发送窗口.jpg" style="zoom:50%;" />

- `SND.WND`：表示发送窗口的大小（大小是由接收方指定的）；
- `SND.UNA`：是一个绝对指针，它指向的是已发送但未收到确认的第一个字节的序列号，也就是 #2 的第一个字节。
- `SND.NXT`：也是一个绝对指针，它指向未发送但可发送范围的第一个字节的序列号，也就是 #3 的第一个字节。
- 指向 #4 的第一个字节是个相对指针，它需要 `SND.UNA` 指针加上 `SND.WND` 大小的偏移量，就可以指向 #4 的第一个字节了。

### 接收方的滑动窗口

> 接收窗口用于记录**可以接收的数据的范围**，其大小反映了接收方当前的**可用缓存空间的大小**。

TCP 接收方滑动窗口方案使用两个指针来对接收的字节数据进行划分。其中一个绝对指针，一个相对指针。

<img src=".\计算机网络学习笔记\TCP接收窗口.jpg" style="zoom:50%;" />

- `RCV.WND`：表示接收窗口的大小，它会通告给发送方。
- `RCV.NXT`：是一个指针，它指向期望从发送方发送来的下一个数据字节的序列号，也就是 #3 的第一个字节。
- 指向 #4 的第一个字节是个相对指针，它需要 `RCV.NXT` 指针加上 `RCV.WND` 大小的偏移量，就可以指向 #4 的第一个字节了。

### 滑动窗口工作机制

**发送窗口范围**内的字节都**允许被发送**，**接收窗口范围**内的字节都**允许被接收**。

如果发送窗口左部的字节已经发送并且接收到了确认，那么就将发送窗口向右滑动一定距离，直到**左部第一个字节不是已发送并且已确认**的状态；接收窗口的滑动类似，接收窗口的**左部字节已经发送确认**，就向右滑动接收窗口。

接收窗口只会对**窗口内最后一个按序到达的字节进行确认**，例如接收窗口已经收到的字节为 {31， 34， 35}，其中 {31} 按序到达，而 {34， 35} 不是，因此只对字节31进行确认。**发送方在得到一个字节的确认之后，就知道这个字节之前的所有字节都已经被接收**。



### 零窗口与 TCP 持续计时器

**零窗口**

>  如果窗口大小为 0 时，就会阻止发送方给接收方传递数据，直到窗口变为非 0 为止，这就是窗口关闭。

当发送窗口关闭时，接收方处理完数据后，会向发送方通告一个窗口非0的 ACK 报文，如果这个通告窗口的 ACK 报文在网络中丢失，发送方会一直等待接收方的非0窗口通知，接收方也一直等待发送方的数据，如不采取措施，这种相互等待的过程，会造成死锁的现象。

<img src=".\计算机网络学习笔记\窗口关闭危险.jpg" style="zoom:50%;" />

**TCP 持续计时器**

> TCP 为每个连接设有一个持续定时器，只要 TCP 连接一方收到对方的零窗口通知，就启动持续计时器。

如果持续计时器超时，就会发送窗口探测（Window probe）报文，而对方在确认这个探测报文时，给出自己现在的接收窗口大小。

<img src=".\计算机网络学习笔记\窗口探测.jpg" style="zoom:50%;" />





## TCP流量控制

> 流量控制是为了**控制发送方的发送速率（动态调节发送方窗口大小），保证接收方来得及处理**。
>
> 当发送方的发送速率**大于**接收方的处理速率时，将会导致**接收方缓存溢出**，因此需要控制发送方的发送速率。

接收方发送的**确认报文中的窗口字段**可以用来**控制发送方窗口大小**，从而影响发送方的发送速率。**接收方窗口的大小意味着接收方还有多大的缓冲区可以用于接收数据**。



## TCP拥塞控制

> 拥塞控制是为了当拥塞发生时，控制 TCP  传输速率，降低整个网络的拥塞程度。
>
> 当网络出现拥塞时，分组将会丢失，此时发送方需要重传，从而导致网络拥塞程度更高；因此，拥塞控制的基本思路是当认为网络即将进入拥塞状态（或者网络中间设备（路由器、交换机）已经由于拥塞而发生丢包情况）时减缓 TCP 传输。

TCP 拥塞控制难点：

+ **如何判断**拥塞状况已发生
+ **如何减缓** TCP 传输
+ **何时恢复** TCP 传输原有速度

基于对网络传输能力的估计，在发送端引入一个窗口控制变量，确保**发送窗口大小**不超过**接收端接收能力**和**网络传输能力**，即 TCP 发送端的发送速率等于接收速率和传输速率中的较小值。

反映网络传输能力的变量称为拥塞窗口（congestion window），记作 `cwnd`。因此，发送端实际窗口 W 就是接收端通知窗口 `awnd `和拥塞窗口 `cwnd` 的较小者：`W = min(cwnd, awnd)`。即 TCP 发送端已经发出但还未经确认的数据量大小（在外数据值），总是小于等于 W。

TCP 主要通过四个算法来进行拥塞控制：慢开始、拥塞避免、快重传、快恢复。

### 慢开始与拥塞避免

TCP 建立连接完成后，当发送方每收到一个 ACK，拥塞窗口 `cwnd `的大小就会加1（**慢开始**）；当拥塞窗口 `cwnd` 超过慢开始门限 `ssthresh`(slow start threshold) 时，每当收到一个 ACK 时，`cwnd` 增加 `1/cwnd`（**拥塞避免**）。 

<img src=".\计算机网络学习笔记\慢开始与拥塞避免.jpg" style="zoom:50%;" />

当 `cwnd` 按照这个规则一直增长下去，网络就会慢慢进入了拥塞的状况（**发生超时重传，就认为网络出现了拥塞**）了，于是就会出现丢包现象，这时就需要对丢失的数据包进行重传。

### 拥塞发生

> 当网络出现拥塞，也就是会发生数据包重传，重传机制主要有两种：
>
> + 超时重传
> + 快速重传

当发生了超时重传，这时 `ssthresh` 设为 `cwnd/2`，`cwnd` 重置为1，重新开始慢开始。

<img src=".\计算机网络学习笔记\拥塞发生—超时重传.jpg" style="zoom:50%;" />

当发生快速重传，这时`cwnd` 重置为原来的一半，`ssthresh` 设为 `cwnd`，进入快速恢复算法。



### 快速恢复

> 快速重传和快速恢复算法一般同时使用，在进入快速恢复之前，`cwnd` 和 `ssthresh` 已被更新：
>
> + `cwnd = cwnd/2`，也就是设置为原来的一半
> + `ssthresh = cwnd`

<img src=".\计算机网络学习笔记\拥塞发生—快速恢复.jpg" style="zoom:50%;" />

快速重传算法：

+ 拥塞窗口 `cwnd = ssthresh + 3` （ 3 的意思是确认有 3 个数据包被收到了）
+ 重传丢失的数据包
+ 进入拥塞避免

慢开始和快恢复的快慢指的是 cwnd 的设定值，而不是 cwnd 的增长速率。慢开始 cwnd 设定为 1，而快恢复 cwnd 设定为 ssthresh。



# 网络层

> 网络层提供**主机到主机**之间的无连接或者有连接的数据报（分组）交付服务，而不同时提供两种服务。仅提供**无连接**的网络称为**数据报网络**（Datagram Network），仅提供**有连接**的网络称为**虚电路网络**（Virtual-Circuit. VC）。
>
> TCP/IP 协议体系中的网络层功能由 IP 协议规定和实现，故又称为 IP 层。IP 层向上提供**无连接**的、**尽力而为**的**数据报**交付服务。

因特网的网络层有三个主要组件。第一个是 **IP 协议**，它是网络层的核心；第二个是**路由选择**部分，它决定了数据报从源到目的地所流经的路径；第三个是 **ICMP 协议**，用于报告数据报中的差错和对某些网络层信息请求进行响应。

<img src=".\计算机网络学习笔记\网络层内部视图.png" style="zoom: 80%;" />

使用 IP 协议，可以把异构的物理网络连接起来，使得在网络层看起来好像是一个统一的网络。

<img src=".\计算机网络学习笔记\网络层作用.png" style="zoom:50%;" />

与 IP 协议配套使用的还有三个协议：

+ 地址解析协议 ARP（Address Resolution Protocol）
+ 网际控制报文协议 ICMP（Internet Control Message Protocol）
+ 网际组管理协议 IGMP（Internet Group Management Protocol）



## IP 数据报格式

<img src=".\计算机网络学习笔记\IP数据报格式.jpg" style="zoom:50%;" />

+ **版本**：有 4（IPv4）和 6（IPv6）两个值。
+ **首部长度**：占 4 位，因此最大值为 15。值为 1 表示的是 1 个 32 位字的长度，也就是 4 字节。因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。
+ **区分服务**：用来获得更好的服务，一般情况下不使用。
+ **总长度**：包括首部长度和数据部分长度。
+ **生存时间**：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由跳数为单位，当 TTL 为 0 时就丢弃数据报。
+ **协议号**：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP等。
+ **首部检验和**：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。
+ **标识**：在数据报长度过长而发生分片的情况下，相同数据报的不同分片具有想太多标识符。
+ **片偏移**：和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。

<img src=".\计算机网络学习笔记\数据报分片.png" style="zoom:50%;" />



## IP 地址编址方式

IP 地址的编址方式经历了三个历史阶段：

+ 分类
+ 子网划分
+ 无分类

### 1.分类

由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。

IP 地址 ::= {< 网络号 >, < 主机号 >}

<img src=".\计算机网络学习笔记\IP分类划分.png" style="zoom:75%;" />

### 2.子网划分

通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。

IP 地址 ::= {< 网络号 >, < 子网号 >, < 主机号 >}

要使用子网，必须配置子网掩码。一个 B 类地址的默认子网掩码为 255.255.0.0，如果 B 类地址的子网占两个比特，那么子网掩码为 11111111 11111111 11000000 00000000，也就是 255.255.192.0。

注意，外部网络看不到子网的存在。

### 3.无分类

无分类编址 CIDR （Classless Interdomain Routing）消除了传统 A 类、B 类和 C 类地址以及划分子网的概念，使用网络前缀和主机号来对 IP 地址进行编码，网络前缀的长度可以根据需要变化。

IP 地址 ::= {< 网络前缀号 >, < 主机号 >}

CIDR 的记法上采用在 IP 地址后面加上网络前缀长度的方法，例如 128.14.35.7/20 表示前 20 位为网络前缀。

CIDR 的地址掩码可以继续称为子网掩码，子网掩码首 1 长度为网络前缀的长度。

一个 CIDR 地址块中有很多地址，一个 CIDR 表示的网络就可以表示原来的很多个网络，并且在路由表中只需要一个路由就可以代替原来的多个路由，减少了路由表项的数量。把这种通过使用网络前缀来减少路由表项的方式称为路由聚合，也称为 **构成超网** 。



## 地址解析协议 ARP

> 在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的 MAC 地址。而在TCP/IP 协议中，网络层和传输层只关心目标主机的 IP 地址。这就导致数据链路层的以太网协议接到上层 IP 协议提供的数据中，只包含目的主机的 IP 地址。于是需要一种方法，根据目的主机的 IP 地址，获得其 MAC 地址。这就是 ARP 协议要做的事情。
>
> ARP，是一种解决地址映射关系问题的协议。以**目标 IP 地址**为线索，用来定位下一个应该接收数据帧的网络设备，所**对应的 MAC 地址**。

网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变。

<img src=".\计算机网络学习笔记\网络通信.jpg" style="zoom:50%;" />

ARP 实现由 IP 地址得到 MAC 地址。

<img src=".\计算机网络学习笔记\ARP协议作用.jpg" style="zoom:50%;" />

每个主机都有一个 ARP 高速缓存，里面有**本局域网**上的各主机和路由器的 IP 地址到 MAC 地址的映射表。

如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到 MAC 地址的映射，此时主机 A 通过广播的方式发送 ARP 请求分组，主机 B 收到该请求后会发送 ARP 响应分组给主机 A 告知其 MAC 地址，随后主机 A 向其高速缓存中写入主机 B 的 IP 地址到 MAC 地址的映射。

当发送主机和目的主机不在同一个局域网中时，即便知道对方的 MAC 地址，两者也不能直接通信，必须经过路由转发才可以。所以此时，发送主机通过 ARP 协议获得的将不是目的主机的真实 MAC地址，而是一台可以通往局域网外的路由器的 MAC 地址。

<img src=".\计算机网络学习笔记\地址解析协议 ARP 的工作原理.png" style="zoom:50%;" />

## 网际控制报文协议 ICMP

> IP 协议本身并没有提供方法来获取协议层配置和数据包处置相关的诊断和控制信息。
>
> 为了解决这些不足之处，将 ICMP 与 IP 结合使用，以便提供与 IP 数据包处置和 IP 协议层配置相关的诊断和控制信息。ICMP 报文使用 IP 协议传输，但它不属于高层协议，通常被认为是 IP 层的一部分。
>
> ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。

<img src=".\计算机网络学习笔记\ICMP报文的格式.jpg" style="zoom:50%;" />

ICMP 报文分为两大类：

+ 差错报告报文（error message）：有关**IP数据报传递**
+ 查询或信息类报文（informational message）：有关**信息采集和配置**

<img src=".\计算机网络学习笔记\ICMP报文类型.png" style="zoom:50%;" />

### Ping

Ping 是 ICMP 的一个重要应用，主要用来测试两台主机之间的连通性。

其原理是通过向目的主机发送 ICMP Echo 请求报文，目的主机收到之后会发送 Echo 回答报文；Ping 会根据时间和成功响应的次数估算出数据包往返时间（RTT）以及丢包率。

**RTT 计算方法**

ping 程序在发出的回显请求报文的可选数据区域中包含了一份本地时间拷贝；被 ping 主机在返回回显应答报文时，请求报文中的数据区域中的内容会被包含在应答中。当应答收到时，ping 程序用当前时间减去应答中的时间，便得到了一个到达被 ping 主机的 RTT 估计值。



### Traceroute

Traceroute 是 ICMP 的另一个应用，用来跟踪一个分组从源点到终点的路径。

Traceroute 发送的 IP 数据报封装的是无法交付的 UDP 用户数据报（目的主机上没有应用程序准备好接受它），并由目的主机发送终点不可达差错报告报文。

- 源主机向目的主机发送一连串的 IP 数据报。第一个数据报 P1 的生存时间 TTL 设置为 1，当 P1 到达路径上的第一个路由器 R1 时，R1 收下它并把 TTL 减 1，此时 TTL 等于 0，R1 就把 P1 丢弃，并向源主机发送一个 ICMP 时间超过差错报告报文；
- 源主机接着发送第二个数据报 P2，并把 TTL 设置为 2。P2 先到达 R1，R1 收下后把 TTL 减 1 再转发给 R2，R2 收下后也把 TTL 减 1，由于此时 TTL 等于 0，R2 就丢弃 P2，并向源主机发送一个 ICMP 时间超过差错报文。
- 不断执行这样的步骤，直到最后一个数据报刚刚到达目的主机，主机不转发数据报，也不把 TTL 值减 1。但是因为数据报封装的是无法交付的 UDP，因此目的主机要向源主机发送 ICMP 终点不可达差错报告报文。
- 之后源主机知道了到达目的主机所经过的路由器 IP 地址以及到达每个路由器的往返时间。



## 虚拟专用网 VPN

由于 IP 地址的紧缺，一个机构能申请到的 IP 地址数往往远小于本机构所拥有的主机数。并且一个机构并不需要把所有的主机接入到外部的互联网中，机构内的计算机可以使用仅在本机构有效的 IP 地址（专用地址）。

有三个专用地址块：

- 10.0.0.0 ~ 10.255.255.255
- 172.16.0.0 ~ 172.31.255.255
- 192.168.0.0 ~ 192.168.255.255

VPN 使用公用的互联网作为本机构各专用网之间的通信载体。专用指机构内的主机只与本机构内的其它主机通信；虚拟指好像是，而实际上并不是，它有经过公用的互联网。

下图中，场所 A 和 B 的通信经过互联网，如果场所 A 的主机 X 要和另一个场所 B 的主机 Y 通信，IP 数据报的源地址是 10.1.0.1，目的地址是 10.2.0.3。数据报先发送到与互联网相连的路由器 R1，R1 对内部数据进行加密，然后重新加上数据报的首部，源地址是路由器 R1 的全球地址 125.1.2.3，目的地址是路由器 R2 的全球地址 194.4.5.6。路由器 R2 收到数据报后将数据部分进行解密，恢复原来的数据报，此时目的地址为 10.2.0.3，就交付给 Y。

![](.\计算机网络学习笔记\虚拟专用网的实现.jpg)



## 网络地址转换 NAT

专用网内部的主机使用本地 IP 地址又想和互联网上的主机通信时，可以使用 NAT 来将本地 IP 转换为全球 IP。

在以前，NAT 将本地 IP 和全球 IP 一一对应，这种方式下拥有 n 个全球 IP 地址的专用网内最多只可以同时有 n 台主机接入互联网。为了更有效地利用全球 IP 地址，现在常用的 NAT 转换表把传输层的端口号也用上了，使得多个专用网内部的主机共用一个全球 IP 地址。使用端口号的 NAT 也叫做**网络地址与端口转换** NAPT。

![](.\计算机网络学习笔记\NAT工作原理.png)



## 路由器

> 工作于网络层的分组交换机，在**不同网络**间转发分组，提供**路由**与**转发**两种重要机制，可以决定数据包从来源端到目的端所经过的路径（host到host之间的传输路径），这个过程称为**路由**；将路由器输入端的数据包移送至适当的路由器输出端（在路由器内部进行），这称为**转发**。

### 结构

路由器从功能上可以划分为：**路由选择**和**分组转发**。

分组转发结构由三个部分组成：交换结构、一组输入端口和一组输出端口。

<img src=".\计算机网络学习笔记\典型的路由器结构.jpg" style="zoom: 67%;" />

### 分组转发

每台路由器都有一张转发表，路由器通过检查到达分组首部字段的值（一般为目的IP地址），然后使用该值在转发表中索引查询，得到该分组将被转发的路由器的输出链路接口，从而将该分组转发到该输出接口。

路由器中的转发表由路由选择算法决定。路由器通过接收路由选择协议报文，使用报文中的信息配置其转发表。

![](.\计算机网络学习笔记\路由分组转发.png)



### 路由选择协议

> 路由选择协议都是自适应的，能随着网络通信量和拓扑结构的变化而自适应地进行调整。其任务就是确定数据报在源与目的地之间采用的**最低费用路径（路由）**。

因特网通过定义自治系统来解决规模与管理责任的问题。自治系统（AS）指的是一个处于相同的管理控制下的路由器的集合。互联网可以划分为许多较小的自治系统  AS，一个 AS 可以使用一种和别的 AS 不同的路由选择协议。

可以把路由选择协议划分为两大类：

+ 自治系统内部路由选择协议：RIP 和 OSPF

+ 自治系统间路由选择协议：BGP


每台路由器接收一个 AS 内部路由选择协议和一个 AS 间路由选择协议的报文，并使用来自这两个协议的信息配置它的转发表。

![](.\计算机网络学习笔记\互联的自治系统.png)

#### 内部网关协议 RIP

> 路由选择信息协议（Routing Information Protocol），一种基于距离向量路由选择算法的协议。
>
> RIP 规定，路由器按固定的时间间隔仅和相邻路由器交换自己的路由表，经过若干次交换之后，所有路由器最终会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器地址。

在 RIP 中，**跳**是沿着源路由器到目的子网（包括目的子网）的最短路径所经过的**子网数量**。

<img src=".\计算机网络学习笔记\源路由到目的子网的跳数.png" style="zoom:67%;" />

一条路径的最大费用（源路由器到目的子网的跳数）被限制为15，因此 RIP 的使用限制在网络直径不超过15跳的自治系统内。

在 RIP 中，路由选择更新信息在邻居之间通过使用一种 **RIP 响应报文**来交换，大约每30秒互换一次。响应报文中包含了一个 AS 内的多达25个目的子网的列表，以及发送方到其中每个子网的距离。

<img src=".\计算机网络学习笔记\一个自治系统.png" style="zoom:67%;" />

每台路由器维护一张称为**路由选择表**（routing table）的 RIP 表，其包括该**路由器的距离向量**（到目的子网的跳数）和该**路由器的转发表**。

上面自治系统中路由器 D 的路由选择表如下：

<img src=".\计算机网络学习笔记\路由选择表.png" style="zoom:67%;" />

收到来自相邻路由器 A 的 RIP 响应报文后，路由器 D 获悉子网 z 离路由器 A 仅有4跳距离，便会更新其内部的路由选择表以记下**更短的最短路径**。

![](.\计算机网络学习笔记\收到RIP通告后的路由选择表.png)



#### 内部网关协议 OSPF

> 开放式最短路径优先（Open Shortest Path First），一种基于链路状态路由选择算法的协议，是为了克服 RIP 的缺点而开发出来的。

开放表示 OSPF 不受某一家厂商控制，而是公开发表的；路由器在本地运行 Dijkstra 的最短路径算法，以确定一个以自身为根节点的到所有子网的最短路径树。

OSPF 具有以下特点：

- 向本自治系统中的**所有其他路由器**广播其**链路状态**。
- **链路状态**包括与哪些路由器相连以及链路的权值，权值用费用、距离、时延、带宽等来表示。
- 当链路状态发生变化时，路由器就会广播信息。即是链路状态未发生变化，它也会周期性地广播链路状态信息。

所有路由器都具有全网的拓扑结构图，并且是一致的。相比于 RIP，OSPF 的更新过程收敛的很快。



#### 外部网关协议 BGP

> 边界网关协议（Broder Gateway Protocol）,用来决定跨域多个 AS 的源和目的对之间的优化路径。

BGP 为每个 AS 提供了进行以下工作的手段：

1. 从相邻 AS 处获得子网可达性信息。
2. 向本 AS 内部的所有路由器传播这些可达性信息。
3. 基于可达性信息和 AS 策略，决定达到子网的“好”路由。

AS 之间的路由选择很困难，主要是由于：

- 互联网规模很大；
- 各个 AS 内部使用不同的路由选择协议，无法准确定义路径的度量；
- AS 之间的路由选择必须考虑有关的策略，比如有些 AS 不愿意让其它 AS 经过。

在 BGP 中，路由器对通过使用179端口的半永久 TCP 连接来交换路由选择信息。对于每条 TCP 连接，位于该连接端点的两台路由器称为 BGP 对等方（BGP peers），沿着该连接发送所有 BGP 报文的 TCP 连接称为 BGP 会话（BGP session）。跨越两个 AS 的 BGP 会话称为外部 BGP会话（external BGP session），在同一个 AS 中的两台路由器之间的 BGP 会话称为内部 BGP会话（internal BGP session）。

<img src=".\计算机网络学习笔记\BGP会话.png"  />



# 链路层

> 网络层提供的是主机与主机之间的数据传输服务，而主机之间可以有很多段链路，链路层为网络层提供两个相邻链路节点之间的数据传输服务。
>
> 数据链路层将**网络层的数据报**用链路层**帧封装**起来，通过**单一通信链路**从一个**节点**移动到**相邻节点**。
>
> 节点：运行链路层协议的任何设备，包括主机、路由器、交换机和 WiFi 接入点。
>
> 链路：沿着通信路径**连接相邻节点的通信信道**称为链路（link）。

链路层**主体部分**是在**网络适配器**（network adapter）中实现，位于网络适配器核心的是链路层控制器，该控制器通常是一个实现了许多链路层服务（成帧、链路接入、差错检测等）的专用芯片。

如下图所示，尽管大部分链路层是在硬件中实现的，但部分链路层是在运行于主机 CPU 上的软件实现的。链路层软件组件实现了高层链路层功能，如**组装**链路层寻址信息和**激活**控制器硬件；在接收端，链路层软件响应控制器**中断**，**处理差错**条件和将数据报**向上传递给网络层**。

所以链路层是**硬件和软件的结合体**。

<img src=".\计算机网络学习笔记\网络适配器与其他主机组件及协议栈功能的关系.png" style="zoom:67%;" />

## 基本功能

### 封装成帧

将网络层传下来的分组添加首部和尾部，用于标记帧的开始和结束。

<img src=".\计算机网络学习笔记\链路层封装成帧.jpg" style="zoom:50%;" />

### 透明传输

透明表示一个实际存在的事物看起来好像不存在一样。

帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定。需要在数据部分出现首部尾部相同的内容前面插入转义字符。如果数据部分出现转义字符，那么就在转义字符前面再加个转义字符。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。

### 差错检测

目前数据链路层广泛使用了循环冗余检验（CRC）来检查比特差错。



## 信道分类

### 按照传输媒质来划分

1. 有线信道

   有线信道以导线为传输媒质，信号沿导线进行传输，信号的能量集中在导线附近，因此传输效率高，但部署不够灵活。这一类信道使用的传输媒质包括电话线、双绞线、对称电缆、同轴电缆和光导纤维等。

2. 无线信道

   无线信道主要以辐射无线电波为传输方式的**无线电信道**和在水下传播声波的**水声信道**。无线信道在自由空间上传播信号，因此能量分散、传输效率较低，但它摆脱了对导线的依赖。

3. 存储信道

   磁带、光盘、磁盘等数据存储媒质也可以被看作是一种通信信道。将数据写入存储媒质的过程即等效于发射机将信号传输到信道的过程，将数据从存储媒质读出的过程即等效于接收机从信道接收信号的过程。

### 按照信道功能来划分

<img src=".\计算机网络学习笔记\广义信道的分类.png" style="zoom:67%;" />

1. 调制信道

   调制信道是指信号从调制器的输出端传输到解调器的输入端经过的部分

2. 编码信道

   编码信道是指数字信号由编码器输出端传输到译码器输入端经过的部分

### 按照信道是否专用来划分

1. 广播信道

   这种信道用于连接有线局域网、卫星网和混合光纤同轴电缆接入网中的多台主机。因为多台主机与相同的广播信道连接，需要**信道复用**技术或**媒体访问协议**来协调帧传输。

2. 点对点信道

   这种信道在长距离链路连接的两台路由器之间，或者用户办公室计算机与它们所连接的邻近以太网交换机之间等场合经常使用。



## 信道复用技术

<img src=".\计算机网络学习笔记\专用信道和复用信道.jpg" style="zoom:67%;" />

### 频分复用（FDM）

<img src=".\计算机网络学习笔记\频分复用示意图.jpg" style="zoom:67%;" />

- 是按频率分割多路信号的方法，即将信道的可用频带分成若干互不交叠的频段，每路信号占据其中的一个频段。
- 在接收端用适当的滤波器将多路信号分开，分别进行解调和终端处理。

当采用频分复用技术时，所有用户在同样的时间占用不同的带宽资源。

<img src=".\计算机网络学习笔记\频分多路复用系统原理.jpg" style="zoom:50%;" />



### 时分复用（TDM）

<img src=".\计算机网络学习笔记\时分复用示意图.jpg" style="zoom:67%;" />

- TDM帧：将传输时间划分为多个等长的时间段（TDM帧）
- 时隙：每个TDM帧划分成更小的时间段（时隙），每个用户在每个TDM帧中占用固定的时隙进行通信。类似分时OS的时间片概念。

当采用时分复用时，所有用户在不同的时间占用同样的频带宽度（分时不分频）。

时分复用可能会造成线路资源的浪费。

<img src=".\计算机网络学习笔记\时分复用缺点.jpg" style="zoom:67%;" />



### 统计时分复用（Statistic TDM）

<img src=".\计算机网络学习笔记\统计时分复用示意图.jpg" style="zoom:67%;" />

集中器：连接低速用户，集中数据传输。

STDM帧

+ 不等长，时隙数小于所连接的用户数
+ 不是固定分配时隙，而是按需分配时隙，可提高线路的利用率。

增加地址信息

+ 由于STDM帧中的时隙不是固定地分配给某个用户，因此在每个时隙中还必须有用户的地址信息，这将产生额外开销。

异步时分复用——指统计时分复用
同步时分复用——指普通时分复用

### 波分复用（WDM）

波分复用就是光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。

<img src=".\计算机网络学习笔记\波分复用示意图.jpg" style="zoom:67%;" />

### 码分复用（CDM）





## 以太网

> 一种计算机有线局域网技术标准，规定了链路层和物理层的协议。

从以太网发明初始到20世纪90年代中期，以太网使用的是**总线型拓扑结构**，是一种广播局域网，即所有传输的帧传送到与该总线连接的适配器并被处理；到20世纪90年代后期，大多数机构使用一种**基于集线器的星形拓扑以太网**（也是一个广播局域网）；在21世纪早期，以太网发生革命性变化，以太网安装继续使用**星形拓扑**，但位于中心的集线器被**交换机**（switch）所替代。

集线器是一种物理层设备， 作用于比特而不是帧，当一个比特到达接口时，集线器重新生成这个比特，并将其能量强度放大，从而扩大网络的传输距离，之后再将这个比特发送到**其它所有接口**。如果集线器同时收到两个不同接口的帧，那么就发生了**碰撞**。

目前以太网使用**交换机替代了集线器**，交换机是一种链路层设备，它**不会发生碰撞**，能根据 MAC 地址进行存储转发。

### 以太网帧结构

![](.\计算机网络学习笔记\以太网帧结构.png)

发送适配器在一个以太网帧中封装了一个 IP 数据报，并把该帧传递到物理层；接收适配器从物理层收到这个帧，提取出 IP 数据报，并把该 IP 数据报传递给网络层。

+ 数据字段（46~1500字节）。这个字段承载了网络层数据报。以太网的最大传输单元（MTU）是1500字节，这意味着如果数据报超过了1500字节，则主机必须将该数据报分片；数据字段的最小长度是46字节，这意味着如果数据报小于46字节，数据报必须被填充到46字节。
+ 目的地址（6字节）。这个字段包含目的适配器的 MAC 地址，当适配器收到一个以太网帧，帧的目的地址为自身 MAC 地址或者广播地址时，它都将该帧的数据字段的内容传递到网络层；如果它收到其他任何 MAC 地址的帧，则丢弃之。
+ 源地址（6字节）。这个字段包含了传输该帧到局域网上的适配器的 MAC 地址。
+ 类型字段（2字节）。类型字段允许以太网复用多种网络层协议。该类型字段和网络层数据报中的协议字段、运输层报文段中的端口号字段相似，都是为了把一层中的某个协议与上一层的某协议结合起来。
+ CRC（4字节）。CRC（循环冗余检测）字段的目的是使得接收适配器检测帧中是否引入了差错。
+ 前同步码（8字节）。以太网帧以一个8字节的前同步码（Preamble）字段开始。该前同步码的前7字节的值都是10101010；最后一个字节是10101011。前同步码字段的前7字节用于“唤醒”接收适配器，并且将它们的时钟和发送方的时钟同步。前同步码的第8个字节的最后两个比特（第一个出现的两个连续的1）警告接收适配器，“重要的内容”就要到来了。

### MAC 地址

MAC 地址是链路层地址，长度为 6 字节（48 位），用于唯一标识网络适配器（网卡）。

一台主机拥有多少个网络适配器就有多少个 MAC 地址。例如笔记本电脑普遍存在无线网络适配器和有线网络适配器，因此就有两个 MAC 地址。

### CSMA/CD共享介质以太网

带冲突检测的载波侦听多路访问（Carrier Sense Multiple Access with Collision Detection，CSMA/CD）技术用于解决总线型拓扑结构以太网和基于集线器的星形拓扑以太网的**信道共享**问题。

某台电脑要发送信息时，在以下行动与状态之间进行转换：

1. **开始** - 如果线路空闲，则启动传输，否则跳转到第4步。
2. **发送** - 如果检测到冲突，继续发送数据直到达到最小回报时间（min echo receive interval）以确保所有其他转发器和终端检测到冲突，而后跳转到第4步。
3. **成功传输** - 向更高层的网络协议报告发送成功，退出传输模式。
4. **线路繁忙** - 持续等待直到线路空闲。
5. **线路空闲** - 在尚未达到最大尝试次数之前，每隔一段随机时间转到第1步重新尝试。
6. **超过最大尝试传输次数（）** - 向更高层的网络协议报告发送失败，退出传输模式。

### 交换机

> 交换机的任务是接收入链路层帧并将它们转发到出链路。

#### 转发和过滤

+ 过滤（filtering）：决定一个帧应该转发到某个接口还是应当将其丢弃的交换机功能
+ 转发（switch）：决定一个帧应该被导向哪个接口，并把该帧移动到哪些接口的交互机功能

交换机的过滤和转发借助于交换机表（switch table）完成。

交换机表中的一个表项包含：1、一个 MAC 地址；2、通向该 MAC 地址的交换机接口；3、表项放置在表中的时间

![](.\计算机网络学习笔记\交换机表.png)

当一个**目的地址**为 BB-BB-BB-BB-BB-BB 链路层帧从交换机**接口 x** 达到时，可能出现以下3种情况：

+ 表中**没有** BB-BB-BB-BB-BB-BB 的表项。在这种情况下，交换机向除 x 外的所有接口前面的输出缓存转发该帧的副本。换言之，如果没有对于目的地址的表项，交换机**广播**该帧。
+ 表中**有**一个表项将 BB-BB-BB-BB-BB-BB 与**接口 x** 联系起来。在这种情况下，该帧从包括适配器 BB-BB-BB-BB-BB-BB 的局域网网段到来。无需将该帧转发到任何其他接口，交换机通过丢弃该帧执行**过滤**功能即可。
+ 表中**有**一个表项将 BB-BB-BB-BB-BB-BB 与**接口 y != x** 联系起来。在这种情况下，该帧需要被转发到与接口 y 相连的局域网网段。交换机通过将该帧放到接口 y 前面的输出缓存完成**转发**功能。

#### 交换机表

> 交换机的表是自动、动态和自治地建立的，即没有来自网络管理员或来自配置协议的任何干预。换句话说，交换机是自学习（self-learning）的。

建表的过程是这样实现的：

1. 交换机表初始为空。

2. 对于在每个接口接收到的每个入帧，该交换机在其表中存储：

   + 在该帧源地址字段中的 MAC 地址
   + 该帧到达的接口
   + 当前时间

   交换机以这种方式在它的表中记录了发送节点所在的局域网网段。如果局域网上的每个节点最终都发送了一个帧，则每个节点最终将在这张表中留有记录。

3. 如果在一段时间（称为老化期（aging time））后，交换机没有接收到以该地址作为源地址的帧，就在表中删除这个地址。

#### 与路由器比较

+ 路由器是使用网络层地址转发分组的存储转发分组交换机
+ 交换机是使用 MAC 地址转发分组的存储转发分组交换机

<img src=".\计算机网络学习笔记\交换机与路由器的分组处理.png" style="zoom:67%;" />

几种主要互联设备之间的比较：

![](.\计算机网络学习笔记\互联设备之间的比较.png)



# 物理层

> 物理层利用传输介质为通信的两端建立、管理和释放物理链接，实现比特流的透明传输，保证比特流正确的传输到对端。

## 通信方式

根据通信使用的信道数量，分为以下两种通信方式：

+ 串行通信：同一时刻只能传输一个比特数据
+ 并行通信：可以同时传输若干比特数据

根据信号在传输线上的传送方向，分为以下三种通信方式：

- 单工通信：单向传输
- 半双工通信：双向交替传输
- 全双工通信：双向同时传输

## 带通调制

模拟信号是连续的信号，数字信号是离散的信号。带通调制把数字信号转换为模拟信号。

<img src=".\计算机网络学习笔记\带通调制.jpg" style="zoom: 50%;" />

